---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.3
  name: mcpregistries.toolhive.stacklok.dev
spec:
  group: toolhive.stacklok.dev
  names:
    kind: MCPRegistry
    listKind: MCPRegistryList
    plural: mcpregistries
    singular: mcpregistry
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .spec.source.type
      name: Source
      type: string
    - jsonPath: .spec.format
      name: Format
      type: string
    - jsonPath: .status.serverCount
      name: Servers
      type: integer
    - jsonPath: .status.lastSyncTime
      name: Last Sync
      type: date
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: MCPRegistry is the Schema for the mcpregistries API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: MCPRegistrySpec defines the desired state of MCPRegistry
            properties:
              displayName:
                description: DisplayName is a human-readable name for the registry
                type: string
              filter:
                description: Filter defines criteria for including/excluding servers
                properties:
                  exclude:
                    description: Exclude specifies patterns for servers to exclude
                    items:
                      type: string
                    type: array
                  include:
                    description: Include specifies patterns for servers to include
                    items:
                      type: string
                    type: array
                  tags:
                    description: Tags specifies tag-based filtering
                    properties:
                      exclude:
                        description: Exclude specifies tags that must not be present
                        items:
                          type: string
                        type: array
                      include:
                        description: Include specifies tags that must be present
                        items:
                          type: string
                        type: array
                    type: object
                type: object
              format:
                default: toolhive
                description: Format specifies the registry data format
                enum:
                - toolhive
                - upstream
                type: string
              source:
                description: Source defines where to fetch registry data from
                properties:
                  configmap:
                    description: |-
                      ConfigMap references a ConfigMap containing registry data
                      Only used when Type is "configmap"
                    properties:
                      key:
                        default: registry.json
                        description: Key is the key in the ConfigMap containing the
                          registry data
                        type: string
                      name:
                        description: Name is the name of the ConfigMap
                        type: string
                      namespace:
                        description: |-
                          Namespace is the namespace of the ConfigMap
                          If not specified, defaults to the MCPRegistry's namespace
                        type: string
                    required:
                    - name
                    type: object
                  git:
                    description: |-
                      Git references a Git repository containing registry data
                      Only used when Type is "git"
                    properties:
                      authentication:
                        description: Authentication defines authentication for Git
                          operations
                        properties:
                          sshKey:
                            description: SSHKey provides SSH key authentication for
                              Git
                            properties:
                              secretRef:
                                description: SecretRef references a Secret containing
                                  the SSH private key
                                properties:
                                  key:
                                    description: Key is the key in the Secret
                                    type: string
                                  name:
                                    description: Name is the name of the Secret
                                    type: string
                                  namespace:
                                    description: |-
                                      Namespace is the namespace of the Secret
                                      If not specified, defaults to the MCPRegistry's namespace
                                    type: string
                                required:
                                - key
                                - name
                                type: object
                            required:
                            - secretRef
                            type: object
                          token:
                            description: Token provides token-based authentication
                              for Git
                            properties:
                              secretRef:
                                description: SecretRef references a Secret containing
                                  the token
                                properties:
                                  key:
                                    description: Key is the key in the Secret
                                    type: string
                                  name:
                                    description: Name is the name of the Secret
                                    type: string
                                  namespace:
                                    description: |-
                                      Namespace is the namespace of the Secret
                                      If not specified, defaults to the MCPRegistry's namespace
                                    type: string
                                required:
                                - key
                                - name
                                type: object
                              token:
                                description: |-
                                  Token is the authentication token
                                  For security, this should reference a Secret
                                type: string
                            type: object
                        type: object
                      path:
                        default: registry.json
                        description: Path is the path within the repository to the
                          registry file
                        type: string
                      ref:
                        default: main
                        description: Ref is the Git reference (branch, tag, or commit)
                        type: string
                      repository:
                        description: Repository is the Git repository URL
                        type: string
                    required:
                    - repository
                    type: object
                  registry:
                    description: |-
                      Registry references an external registry
                      Only used when Type is "registry"
                    properties:
                      authentication:
                        description: Authentication defines authentication for registry
                          access
                        properties:
                          basicAuth:
                            description: BasicAuth provides basic authentication credentials
                            properties:
                              password:
                                description: |-
                                  Password is the password for basic auth
                                  For security, this should reference a Secret
                                type: string
                              secretRef:
                                description: SecretRef references a Secret containing
                                  the password
                                properties:
                                  key:
                                    description: Key is the key in the Secret
                                    type: string
                                  name:
                                    description: Name is the name of the Secret
                                    type: string
                                  namespace:
                                    description: |-
                                      Namespace is the namespace of the Secret
                                      If not specified, defaults to the MCPRegistry's namespace
                                    type: string
                                required:
                                - key
                                - name
                                type: object
                              username:
                                description: Username is the username for basic auth
                                type: string
                            required:
                            - username
                            type: object
                          bearerToken:
                            description: BearerToken provides a bearer token for authentication
                            properties:
                              secretRef:
                                description: SecretRef references a Secret containing
                                  the bearer token
                                properties:
                                  key:
                                    description: Key is the key in the Secret
                                    type: string
                                  name:
                                    description: Name is the name of the Secret
                                    type: string
                                  namespace:
                                    description: |-
                                      Namespace is the namespace of the Secret
                                      If not specified, defaults to the MCPRegistry's namespace
                                    type: string
                                required:
                                - key
                                - name
                                type: object
                              token:
                                description: |-
                                  Token is the bearer token value
                                  For security, this should reference a Secret
                                type: string
                            type: object
                        type: object
                      url:
                        description: URL is the base URL of the external registry
                        type: string
                    required:
                    - url
                    type: object
                  type:
                    description: Type specifies the source type
                    enum:
                    - configmap
                    - url
                    - git
                    - registry
                    type: string
                  url:
                    description: |-
                      URL references an HTTP/HTTPS endpoint serving registry data
                      Only used when Type is "url"
                    properties:
                      authentication:
                        description: Authentication defines authentication for the
                          HTTP request
                        properties:
                          basicAuth:
                            description: BasicAuth provides basic authentication credentials
                            properties:
                              password:
                                description: |-
                                  Password is the password for basic auth
                                  For security, this should reference a Secret
                                type: string
                              secretRef:
                                description: SecretRef references a Secret containing
                                  the password
                                properties:
                                  key:
                                    description: Key is the key in the Secret
                                    type: string
                                  name:
                                    description: Name is the name of the Secret
                                    type: string
                                  namespace:
                                    description: |-
                                      Namespace is the namespace of the Secret
                                      If not specified, defaults to the MCPRegistry's namespace
                                    type: string
                                required:
                                - key
                                - name
                                type: object
                              username:
                                description: Username is the username for basic auth
                                type: string
                            required:
                            - username
                            type: object
                          bearerToken:
                            description: BearerToken provides a bearer token for authentication
                            properties:
                              secretRef:
                                description: SecretRef references a Secret containing
                                  the bearer token
                                properties:
                                  key:
                                    description: Key is the key in the Secret
                                    type: string
                                  name:
                                    description: Name is the name of the Secret
                                    type: string
                                  namespace:
                                    description: |-
                                      Namespace is the namespace of the Secret
                                      If not specified, defaults to the MCPRegistry's namespace
                                    type: string
                                required:
                                - key
                                - name
                                type: object
                              token:
                                description: |-
                                  Token is the bearer token value
                                  For security, this should reference a Secret
                                type: string
                            type: object
                        type: object
                      headers:
                        additionalProperties:
                          type: string
                        description: Headers contains optional HTTP headers for the
                          request
                        type: object
                      tlsConfig:
                        description: TLSConfig defines TLS configuration for HTTPS
                          requests
                        properties:
                          caBundle:
                            description: CABundle is a PEM-encoded CA certificate
                              bundle
                            type: string
                          insecureSkipVerify:
                            default: false
                            description: InsecureSkipVerify skips TLS certificate
                              verification
                            type: boolean
                        type: object
                      url:
                        description: URL is the HTTP/HTTPS endpoint serving registry
                          data
                        pattern: ^https?://.*
                        type: string
                    required:
                    - url
                    type: object
                required:
                - type
                type: object
              syncPolicy:
                description: SyncPolicy defines the synchronization behavior
                properties:
                  interval:
                    default: 1h
                    description: |-
                      Interval specifies the sync interval for automatic synchronization using Go duration format.
                      Valid units: s (seconds), m (minutes), h (hours)
                      Examples: "3m", "1h", "24h" (1 day), "168h" (1 week), "720h" (1 month)
                      Only used when Type is "automatic"
                    type: string
                  retryPolicy:
                    description: RetryPolicy defines retry behavior for failed syncs
                    properties:
                      backoffInterval:
                        default: 30s
                        description: BackoffInterval is the base interval between
                          retries
                        type: string
                      backoffMultiplier:
                        default: "2.0"
                        description: BackoffMultiplier is the multiplier for exponential
                          backoff
                        type: string
                      maxAttempts:
                        default: 3
                        description: MaxAttempts is the maximum number of retry attempts
                        format: int32
                        minimum: 1
                        type: integer
                    type: object
                  type:
                    default: manual
                    description: Type specifies the sync policy type
                    enum:
                    - manual
                    - automatic
                    type: string
                type: object
            required:
            - source
            type: object
          status:
            description: MCPRegistryStatus defines the observed state of MCPRegistry
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the MCPRegistry's state
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              lastSyncHash:
                description: |-
                  LastSyncHash is a hash of the registry data from the last sync
                  Used to detect changes and avoid unnecessary updates
                type: string
              lastSyncTime:
                description: LastSyncTime is the timestamp of the last successful
                  synchronization
                format: date-time
                type: string
              message:
                description: Message provides additional information about the current
                  phase
                type: string
              phase:
                description: Phase is the current phase of the MCPRegistry
                enum:
                - Pending
                - Syncing
                - Ready
                - Failed
                - Updating
                type: string
              serverCount:
                description: ServerCount is the number of servers currently in the
                  registry
                format: int32
                type: integer
              storageRef:
                description: StorageRef references the storage location for the registry
                  data
                properties:
                  configMapRef:
                    description: ConfigMapRef references the ConfigMap storing the
                      registry data
                    properties:
                      key:
                        description: Key is the key in the ConfigMap
                        type: string
                      name:
                        description: Name is the name of the ConfigMap
                        type: string
                      namespace:
                        description: Namespace is the namespace of the ConfigMap
                        type: string
                    type: object
                  type:
                    description: Type specifies the storage type
                    type: string
                type: object
              syncAttempts:
                description: SyncAttempts tracks the number of sync attempts for the
                  current operation
                format: int32
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
